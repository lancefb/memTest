from flask import Flask, render_template, request, session, redirect, url_for
import random

app = Flask(__name__)
app.secret_key = 'the_secret_key'

@app.route('/', methods=['GET', 'POST'])
def index():
    if 'state' not in session:
        # Initialize the session with the necessary keys
        session['state'] = 'numbers'
        session['random_numbers'] = random.sample(range(100), 3)
        session['jokes'] = [
            "Why don't scientists trust atoms? Because they make up everything!",
            "What do you get if you cross a cat with a dark horse? Kitty Perry."
        ]

    if request.method == 'POST':
        if session['state'] == 'numbers':
            session['state'] = 'joke1'
        elif session['state'] == 'joke1':
            session['state'] = 'joke2'
        elif session['state'] == 'joke2':
            session['state'] = 'input'
        elif session['state'] == 'input':
            input_numbers = request.form['numbers'].split(', ')
            if input_numbers == session['random_numbers']:
                session['message'] = 'Congratulations, you remembered correctly!'
            else:
                session['message'] = 'Sorry, that is not correct.'
            session.pop('state', None)
            session.pop('random_numbers', None)
            session.pop('jokes', None)
            return redirect(url_for('result'))
    
    joke = session['jokes'][0] if session['state'] == 'joke1' else session['jokes'][1] if session['state'] == 'joke2' else ''
    return render_template('index.html', random_numbers=session['random_numbers'], joke=joke, state=session['state'])

@app.route('/result', methods=['GET'])
def result():
    return render_template('result.html', message=session['message'])

if __name__ == '__main__':
    app.run(debug=True)
